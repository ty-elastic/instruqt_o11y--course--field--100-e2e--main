{
    "id": "search_logs_error",
    "type": "esql",
    "description": "For a given time window, find logs that would indicate potential problems",
    "tags": [
        "rca"
    ],
    "configuration": {
        "query": "FROM logs-*\n| WHERE @timestamp >= ?search_start AND @timestamp <= ?search_end\n| WHERE k8s.namespace.name == ?k8s_namespace OR k8s.namespace.name IS NULL\n| WHERE TO_UPPER(log.level) IN (\"WARN\", \"WARNING\", \"SEVERE\", \"FATAL\", \"ERROR\") OR TO_UPPER(message) LIKE \"*ERROR*\" OR TO_UPPER(message) LIKE \"*FAIL*\" OR TO_UPPER(message) LIKE \"*PROBLEM*\"\n| STATS pattern_count = COUNT() BY pattern = CATEGORIZE(message), service.name\n| WHERE pattern IS NOT NULL\n| INLINE STATS top_count = TOP(pattern_count, 5, \"desc\") BY service.name\n| WHERE pattern_count >= LEAST(top_count)\n| SORT service.name, pattern_count\n| LIMIT 1000",
        "params": {
            "search_start": {
                "type": "date",
                "description": "start of time window",
                "optional": false
            },
            "search_end": {
                "type": "date",
                "description": "end of time window",
                "optional": false
            },
            "k8s_namespace": {
                "type": "string",
                "description": "kubernetes namespace",
                "optional": true
            }
        }
    },
    "readonly": false
}